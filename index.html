<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Space Shooter Deluxe</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
  color:#0f0;
  font-family:sans-serif;
  touch-action:none;
}
canvas{
  display:block;
  width:100vw;
  height:100vh;
}
#hud,#controls,#menu,#touchControls{
  position:fixed;
  z-index:10;
}
#hud{
  left:12px; top:12px;
  font-weight:700; color:#0ff;
}
#hud div{ margin-bottom:4px; }
#controls{ right:12px; top:12px; }
#menu{
  top:0; left:0;
  width:100vw; height:100vh;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  background:rgba(0,0,0,0.85);
  color:#0ff; font-size:24px;
}
button{
  margin-top:10px; padding:8px 14px;
  border-radius:6px; border:0;
  background:#222; color:#0ff;
  cursor:pointer;
}
#touchControls{
  bottom:10px; left:50%;
  transform:translateX(-50%);
  display:flex; gap:12px;
}
#touchControls button{
  width:70px; height:70px;
  border-radius:50%; font-size:24px;
  background:rgba(20,20,20,0.85);
  border:2px solid #0ff; color:#0ff;
}
</style>
</head>

<body>

<div id="menu">
  <div id="menuTitle">Space Shooter Deluxe</div>
  <div id="menuSubtitle">Produced & Developed by Mahd Rashid</div>
  <div id="menuExtra">Uata Marques Byron are mad buns</div>
  <button id="startBtn">Start Game</button>
</div>

<div id="hud">
  <div id="scoreEl">Score: 0</div>
  <div id="livesEl">Lives: 3</div>
  <div id="onlineEl">Players Online: 0</div>
</div>

<div id="controls">
  <button id="pauseBtn">Pause</button>
  <button id="resumeBtn">Resume</button>
</div>

<div id="touchControls">
  <button id="leftBtn">‚óÄ</button>
  <button id="fireBtn">‚óè</button>
  <button id="rightBtn">‚ñ∂</button>
</div>

<canvas id="game"></canvas>

<!-- FAAAAHH SOUND -->
<audio id="hitSound" src="https://files.catbox.moe/f7rg41.mp3"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let W = canvas.width = innerWidth;
let H = canvas.height = innerHeight;

// Game vars
let paused = false;
let score = 0;
let bullets = [], enemies = [], enemyBullets = [];
let stars = [], particles = [], explosions = [];
let flashRed = 0;

// Player
const player = {
  x: W/2, y: H-80,
  w: 40, h: 40,
  speed: 400,
  laserLevel: 1,
  hits: 0,
  maxHits: 3,
  tilt: 0
};

// Input
const keys = { left:false, right:false };
document.addEventListener("keydown", e=>{
  if(e.key==="a") keys.left=true;
  if(e.key==="d") keys.right=true;
});
document.addEventListener("keyup", e=>{
  if(e.key==="a") keys.left=false;
  if(e.key==="d") keys.right=false;
});

// Shoot
function shoot(){
  if(paused) return;
  for(let i=-player.laserLevel+1;i<=player.laserLevel-1;i++){
    bullets.push({ x:player.x+i*10, y:player.y-20, r:5, dy:-600 });
  }
}
canvas.addEventListener("pointerdown", shoot);

// Mobile
function bind(btn, key){
  btn.addEventListener("pointerdown", ()=>keys[key]=true);
  btn.addEventListener("pointerup", ()=>keys[key]=false);
}
bind(leftBtn, "left");
bind(rightBtn, "right");
fireBtn.addEventListener("pointerdown", shoot);

// ‚úÖ Online counter 860‚Äì900
function getFakePlayersOnline(){
  // random number between 860 and 900
  return Math.floor(Math.random() * (900 - 860 + 1)) + 860;
}
function updatePlayersOnline(){
  onlineEl.textContent = "Players Online: " + getFakePlayersOnline();
}
// set once at start
updatePlayersOnline();
// change every few seconds so it looks real
setInterval(updatePlayersOnline, 3500);

// Stars
for(let i=0;i<200;i++){
  stars.push({
    x:Math.random()*W,
    y:Math.random()*H,
    s:Math.random()*2+1,
    v:Math.random()*40+20
  });
}

// Enemy spawn
function spawnEnemy(){
  enemies.push({
    x:Math.random()*(W-60)+30,
    y:-40,
    w:40, h:40,
    speed:180 + Math.random()*120,   // FASTER
    shootTimer:0.4 + Math.random()*0.5, // üî• shoots a bit more often
    hp:3                                // üî• 3-shot enemies
  });
}
setInterval(spawnEnemy, 1200);

function createExplosion(x,y){
  for(let i=0;i<22;i++){
    explosions.push({
      x, y,
      vx:(Math.random()*2-1)*200,
      vy:(Math.random()*2-1)*200,
      life:0.6,
      r:Math.random()*3+2
    });
  }
}

const hitSound = document.getElementById("hitSound");

// Safe hit sound (prevents freeze)
function playerHit(){
  player.hits++;
  flashRed = 0.2;

  try {
    hitSound.pause();
    hitSound.currentTime = 0;
    hitSound.play().catch(()=>{});
  } catch(e){}

  if(player.hits >= player.maxHits){
    showGameOver();
    return;
  }

  livesEl.textContent = "Lives: " + (player.maxHits - player.hits);
}

function showGameOver(){
  paused = true;
  menuTitle.textContent = "Game Over";
  menuSubtitle.textContent = "Final Score: " + score;
  menuExtra.textContent = "Tap to play again";
  startBtn.textContent = "Play Again";
  menu.style.display = "flex";
}

function update(dt){
  if(paused) return;

  // Move + tilt
  if(keys.left){ player.x-=player.speed*dt; player.tilt=-0.25; }
  else if(keys.right){ player.x+=player.speed*dt; player.tilt=0.25; }
  else player.tilt=0;

  player.x = Math.max(30, Math.min(W-30, player.x));

  // Thruster particles
  particles.push({
    x:player.x+(Math.random()*20-10),
    y:player.y+30,
    vy:150+Math.random()*100,
    alpha:1,
    size:2+Math.random()*2
  });

  // Stars
  for(let s of stars){
    s.y+=s.v*dt;
    if(s.y>H){ s.y=0; s.x=Math.random()*W; }
  }

  // Bullets
  for(let i=bullets.length-1;i>=0;i--){
    bullets[i].y+=bullets[i].dy*dt;
    if(bullets[i].y<-10) bullets.splice(i,1);
  }

  // Enemies
  for(let i=enemies.length-1;i>=0;i--){
    let e=enemies[i];
    e.y+=e.speed*dt;

    if(e.y>H+40){ enemies.splice(i,1); continue; }

    e.shootTimer -= dt;
    if(e.shootTimer<=0){
      enemyBullets.push({
        x:e.x+20, y:e.y+30, r:6,
        dy:900   // üî• enemy bullets move faster
      });
      e.shootTimer = 0.4 + Math.random()*0.5; // keep it fast
    }

    // bullet hit (3-shot logic)
    for(let j=bullets.length-1;j>=0;j--){
      let b = bullets[j];
      if(b.x>e.x && b.x<e.x+e.w && b.y>e.y && b.y<e.y+e.h){
        bullets.splice(j,1);
        e.hp--;                         // üî• take 1 HP

        if(e.hp<=0){
          enemies.splice(i,1);
          score += 10;
          scoreEl.textContent = "Score: " + score;
          player.laserLevel++;
          createExplosion(e.x+20, e.y+20);
        }
        break;
      }
    }
  }

  // Enemy bullets
  for(let i=enemyBullets.length-1;i>=0;i--){
    let b = enemyBullets[i];
    b.y+=b.dy*dt;
    if(b.y>H){ enemyBullets.splice(i,1); continue; }

    if(
      b.x>player.x-20 && b.x<player.x+20 &&
      b.y>player.y-20 && b.y<player.y+20
    ){
      enemyBullets.splice(i,1);
      playerHit();
    }
  }

  // Particles FIX
  for(let i=particles.length-1;i>=0;i--){
    let p = particles[i];
    p.y += p.vy * dt;
    p.alpha -= dt * 1.5;
    if(p.alpha <= 0) particles.splice(i,1);
  }

  // Explosions FIX
  for(let i=explosions.length-1;i>=0;i--){
    let p = explosions[i];
    p.x += p.vx * dt;
    p.y += p.vy * dt;
    p.life -= dt;
    if(p.life <= 0) explosions.splice(i,1);
  }

  if(flashRed>0) flashRed -= dt;
}

function draw(){
  ctx.clearRect(0,0,W,H);

  // Flash
  if(flashRed>0){
    ctx.fillStyle=`rgba(255,0,0,${flashRed})`;
    ctx.fillRect(0,0,W,H);
  }

  // Stars
  ctx.fillStyle="#ffffff";
  for(let s of stars){
    ctx.globalAlpha=s.s/3;
    ctx.fillRect(s.x,s.y,s.s,s.s);
  }
  ctx.globalAlpha=1;

  // Thruster particles
  for(let p of particles){
    ctx.globalAlpha=p.alpha;
    ctx.fillStyle="#44ccff";
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fill();
  }
  ctx.globalAlpha=1;

  // Player Ship
  ctx.save();
  ctx.translate(player.x,player.y);
  ctx.rotate(player.tilt);

  // Flame
  ctx.fillStyle="rgba(0,150,255,0.8)";
  ctx.beginPath();
  ctx.moveTo(-6,28);
  ctx.lineTo(6,28);
  ctx.lineTo(0,45);
  ctx.closePath();
  ctx.fill();

  // Body
  ctx.fillStyle="#4db8ff";
  ctx.beginPath();
  ctx.moveTo(0,-32);
  ctx.bezierCurveTo(18,-20,22,5,10,28);
  ctx.bezierCurveTo(3,40,-3,40,-10,28);
  ctx.bezierCurveTo(-22,5,-18,-20,0,-32);
  ctx.closePath();
  ctx.fill();

  // Cockpit
  ctx.fillStyle="#99e6ff";
  ctx.beginPath();
  ctx.ellipse(0,-5,10,13,0,0,Math.PI*2);
  ctx.fill();

  // Wings
  ctx.fillStyle="#3399ff";
  ctx.beginPath(); ctx.moveTo(-10,0); ctx.lineTo(-40,20); ctx.lineTo(-10,18); ctx.closePath(); ctx.fill();
  ctx.beginPath(); ctx.moveTo(10,0); ctx.lineTo(40,20); ctx.lineTo(10,18); ctx.closePath(); ctx.fill();

  ctx.restore();

  // Player bullets
  ctx.fillStyle="#ffff66";
  for(let b of bullets){
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
  }

  // Enemies
  for(let e of enemies){
    ctx.save();
    ctx.translate(e.x+20,e.y+20);

    ctx.fillStyle="#ff3333";
    ctx.beginPath();
    ctx.moveTo(0,-20);
    ctx.lineTo(18,15);
    ctx.lineTo(-18,15);
    ctx.closePath();
    ctx.fill();

    ctx.fillStyle="#ff9999";
    ctx.beginPath();
    ctx.arc(0,-4,6,0,Math.PI*2);
    ctx.fill();

    ctx.fillStyle="#cc0000";
    ctx.fillRect(-26,6,52,6);

    ctx.restore();
  }

  // Explosions
  for(let p of explosions){
    ctx.globalAlpha=p.life;
    ctx.fillStyle="#ffdd55";
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  }
  ctx.globalAlpha=1;

  // Enemy bullets
  ctx.fillStyle="#ff69b4";
  for(let b of enemyBullets){
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
  }
}

function resetGame(){
  score = 0;
  bullets = [];
  enemies = [];
  enemyBullets = [];
  particles = [];
  explosions = [];
  player.x = W/2;
  player.hits = 0;
  player.laserLevel = 1;
  scoreEl.textContent = "Score: 0";
  flashRed = 0;
}

startBtn.addEventListener("pointerdown", ()=>{
  menu.style.display="none";
  paused = false;
  resetGame();
});

pauseBtn.addEventListener("pointerdown", ()=>paused=true);
resumeBtn.addEventListener("pointerdown", ()=>paused=false);

let last = 0;
function loop(ts){
  let dt = (ts-last)/1000;
  last = ts;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

window.addEventListener("resize", ()=>{
  W = canvas.width = innerWidth;
  H = canvas.height = innerHeight;
});
</script>
</body>
</html>
